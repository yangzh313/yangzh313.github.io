- 第1章 数据所面临的风险，为什么要备份数据
	- 1.1 人为错误
		- 1.1.1 操作失误
		- 1.1.2 代码错误
		- 1.1.3 恶意攻击
		- 1.1.4 恐怖攻击
			- 321的1，要把其中一个备份放到远处。
		- 1.1.5 电子攻击
		- 1.1.6 勒索软件ransomware
		- 1.1.7 内部威胁
			- 让他们总是以自己的身份登陆系统
			- 不要把root密码告诉任何人
			- 删除或禁用那种能够提供shell环境的程序
			- 让超级用户只能通过控制台登陆
			- 启用主机之外的记录机制
			- 不让计算机从其他启动盘启动
			- 1.1.7.1 将各种权限分离
			- 1.1.7.2 基于角色的管理 role-based administration
			- 1.1.7.3 最低权限
			- 1.1.7.4 多人认证机制
	- 1.2 机械故障或系统故障
		- Raid与纠删码
		- 1.2.1 电力中断
		- 1.2.2 云平台没有那么神奇
		- 1.2.3 系统故障
	- 1.3 自然灾害
		- 1.3.1 水灾
		- 1.3.2 火灾
		- 1.3.3 地震
		- 1.3.4 飓风、台风、旋风
		- 1.3.5 龙卷风
		- 1.3.6 落水洞
	- 1.4 小结
		- 备份并不是重点，重点在于有备份，才能恢复数据。
- 第2章 收集需求并确定数据保护系统所应达到的服务水准
	- 2.1 了解组织的工作内容
	- 2.2 构建自己的框架
	- 2.3 收集需求
		- 2.3.1 确定RPO与RTO
		- 2.3.2 寻找SME
		- 2.3.3 厘清需求
		- 2.3.4 评审需求
	- 2.4 设计并构建数据保护系统
		- 2.4.1 起草多种设计方案
			- 提出多种满足需求的设计方案-每种方案的价格、实际恢复时间（Recovery Time Actual, RTA)、实际恢复点（Recovery Point Actual，RPA）都不同。
			- 第一种方案总应该是那种无论要什么都尽量安排，无论花多少钱。
		- 2.4.2 评审设计方案
		- 2.4.3 挑选部件并以此构建数据保护系统
	- 2.5 编写操作文档并将此数据保护系统纳入工作环境
		- 2.5.1 界定每个人的操作角色
		- 2.5.2 编写操作文档
		- 2.5.3 劝说大家编写文档
			- 写文档才是你最应该做的事情。想去度假？想休息一天？如果这个系统有问题，大家总是来找你解决，那就不要想了。
		- 2.5.4 文档具体该怎么写
			- SOP, standard operating procedure
		- 2.5.5 把这个新数据保护系统纳入工作环境
			- CAB(变更咨询委员会)
- 第3章 备份与档案区别很大
	- 3.1 探讨两者区别之前的思想准备
	- 3.2 什么是备份
		- 备份是对数据所做的一份copy，它与原数据分开存放，并且能够把这份数据恢复到早前的状态，之所以恢复，通常是因为原数据受某种原因影响而遭到删除或破坏。
		- 3.2.1 备份必须是一份copy
			- 依赖原数据而存在的快照，不是一份合格的copy，必须把它重制（也就是复制）到其他地方，才能让它成为一份真正的copy。
		- 3.2.2 备份必须与原数据分开存放
		- 3.2.3 备份必须能够用来恢复数据
			- archive符合前两项要求，但不是用来恢复数据的，它们是用来获取数据的，这跟恢复数据不是一回事。
		- 3.2.4 什么是恢复
			- 指的是一种通过备份让数据回到早前状态的操作。
		- 3.2.5 数据是怎样得到恢复的
		- 3.2.6 3-2-1原则
			- 3.2.6.1 至少对数据做3个版本的备份
				- 有时会接连发生失误，最近的那个备份可能是在文件已经破坏的时候制作的，如果用这个版本的备份恢复数据，那么恢复出来的文件依然是坏的。因此，至少保留3个版本。
			- 3.2.6.2 把备份放在2个不同的介质中
			- 3.2.6.3 将其中1份放在远处
				- 对于云端资源来说，最好能在另一个区里单独创建一个账号，让这个账号专门用来保存备份数据，并把其他区里的哪些账号所制作的备份全部汇给这个账号。这个账号最好支持多人认证，这样必须有两个人登录该账号才能删除备份。
	- 3.3 什么是档案
		- 档案是存放在另一个地方的数据副本，是一种用来做参考的副本，其中存储着必要的metadata，让我们不用指出来源，就能找到所需的数据。
		- 档案与备份之间的真正区别在于：为了不同的目标而保存档案与备份，获取的理由不同，保存方式及获取方式也不同。
		- 3.3.1 档案是为了参考而制作的
		- 3.3.2 档案里有附加的metadata
		- 3.3.3 什么是获取
	- 3.4 保护备份数据与档案数据
		- 3.4.1 加密
			- 备份数据只应该由备份程序来访问，一定要给备份加密，这样就算有人入侵云平台并且拿到了备份，他也读不懂其中的内容。
		- 3.4.2 设置屏障 air gap
			- 3.4.2.1 物理屏障
				- 比如将磁带交给保管方保管。
			- 3.4.2.2 虚拟屏障
				- 确保数据不可变。
				- 禁用或限制使用RDP（远程桌面协议）
				- 使用不同的操作系统
				- 把存放备份数据的地方跟其他东西隔开，比如nfs
				- 使用对象存储系统
				- 使用不可变的存储机制
				- 使用磁带保存备份数据
				- 使用特制备份服务
					- 有这样一种备份服务，即便是系统管理员也没有办法登录到运行该服务的备份服务器上。
		- 3.4.3 不可变性
			- 必须确保备份与档案数据不会遭到无意或恶意的擦除与破坏。
			- 没有什么东西能做到绝对不可变
			- 必须施加多种管控措施以确保不可变性
			- 不可变并不意味着不会遭到破坏
			- 许多号称不可变的机制其实并非真正的不可变
- 第4章 备份与恢复的基础知识
	- 4.1 恢复测试
		- 没有经过测试的备份不算真正的备份！
	- 4.2 备份级别
		- 4.2.1 传统意义上的完全备份
		- 4.2.2 传统意义上的增量备份
			- 4.2.2.1 标准的增量备份
				- typical incremental bacu是把从上次备份算起发生变化的所有数据都备份下来，无论上次是全量还是增量备份。
			- 4.2.2.2 积累式的增量备份
				- 差量备份
			- 4.2.2.3 带有层次的增量备份
				- 汉诺塔备份方案
			- 4.2.2.4 块级别的增量备份
			- 4.2.2.5 源数据端的重复数据删除
				- 简称源端去重
				- 判断新“块”是否已经啊发送到备份服务器了。
			- 4.2.2.6 合成式的完全备份
				- 通过复制制作合成式的完全备份
				- 通过目标去重设备来模拟合成式的完全备份
				- 从刚开始就一直做增量备份
		- 4.2.3 备份级别真的那么重要吗
	- 4.3 数据保护系统的各项指标
		- 4.3.1 与恢复有关的指标
			- 4.3.1.1 RTO
				- Recovery Time Objective，恢复时间目标用来表示系统在遇到事故之后，需要花多长时间才能恢复。
			- 4.3.1.2 RPO
				- Recovery Point Objective，恢复点目标是指遇到事故之后，最多能允许多长时间内的数据遭受损失。
			- 4.3.1.3 在沟通中确定RPO与RTO
				- 如果组织有理由要把RTO与RPO压到0或者某个接近0的值，那么应该说明停工时遭受多少损失，以表明花费大量资金来压低RTO与RPO是值得的，不这么做的损失更大。
			- 4.3.1.4 RTA与RPA
				- 实际恢复时间与实际恢复点，只有在执行恢复时才能测量，用来表示受测系统能够在多大程度上满足RTO和RPO目标。
			- 4.3.1.5 测试该系统的实际恢复效果
				- 不仅要熟悉备份，还要熟悉恢复，办法是做恢复测试。
		- 4.3.2 与系统的能力或容量有关的指标
			- 4.3.2.1 系统对授权与工作负载的使用量
			- 4.3.2.2 总的存储容量与已使用的容量
			- 4.3.2.3 数据处理速度
			- 4.3.2.4 计算能力
		- 4.3.3 备份窗口
		- 4.3.4 备份与恢复的成功率与失败率
			- 应该有人把执行备份与恢复的次数记录下来，并计算出各自的成功率。
		- 4.3.5 保留测率
			- 被遗忘权
				- Right to be forgotten，RTBF，这个权力的正式说法应该是擦除权（right to erasure）。
		- 4.3.6 利用各项指标
	- 4.4 涉及备份与档案的一些误解
		- RAID不需要备份
			- RAID所能提供的冗余是在硬件层面，无法保护文件系统层面的丢失。
		- 启用了数据复制机制就不用再做备份了
			- 复制或者重制只是把所有东西都照搬一遍，无论正确与否。
		- IaaS与PaaS不需要备份
			- 高可用性无法防范误操作、网络攻击或者数据中心遭到物理破坏的情况。
			- 重点在于，一定要把云端备份跟云端主账号分开存放，而且不要放在跟主数据相同的区域里面。
		- SaaS不需要备份
			- SaaS厂商顶多提供利用版本管理系统与回收站等机制而打造的便捷恢复功能，无法防范严重故障或网络攻击。
		- 备份系统应该把备份数据保存好多年，以便从中调取信息
			- 备份产品通常不用来做档案方面的工作。
		- 磁带已经消亡
		- 把备份当成档案来用，成本真的相当高
	- 4.5 条目级备份与镜像级备份
		- item-level backup和image-level backup。
		- 4.5.1 条目级备份
			- 常见形式是文件。另外一种形式是对象存储系统里面的对象。优势在于这种备份方式特别好懂。
		- 4.5.2 镜像级备份
			- 镜像级备份是再数据块block的层面备份某个物理设备或者虚拟设别，这样制作出来的是整个设备的一份镜像。
			- 虚拟快照技术的出现解决了数据块时间点不一致的问题。
			- 速度比文件界别快得多，省去了文件创建的开销。
			- CBT(changed-block tracking，数据块修改追踪）技术，记录上一次备份时间点算起发生变化的数据块记录下来，实现块级别的增量备份。
		- 4.5.3 从镜像级备份里做文件级恢复
			- 一个办法是把VMDK文件挂载成虚拟盘（volume），使得可以通过文件浏览操作这个盘。一般是只读模式。
			- 还有的备份软件会提前给镜像内容制作索引，通过索引来了解某份文件在镜像中是由哪几个数据块表示。
		- 4.5.4 把文件级备份与镜像级备份结合起来
			- 大多数用户在备份虚拟机时做的都是镜像级备份，这样还能让他们在这种镜像的基础上做增量备份，并从中恢复单个的条目。
	- 4.6 怎样选择有待备份的内容
		- 4.6.1 包含法与排除法
			- selective inclusion and selective exclusion。
			- 在划定备份范围的时候，默认应该采用排除法，应该把时间用在其他一些管理工作上。
			- 备份工作要把安全地保护数据库放在第一位，成本是次要地。
		- 4.6.2 根据标签或目录来选择
- 第5章 用磁盘与去重技术保护数据
	- 真正让磁盘成为保存备份数据的主要场地的原因在于去重技术。
	- 5.1 去重技术
		- deduplication，全称为重复数据删除技术。
		- 5.1.1 去重技术的功能
			- 同一文件的多个版本
			- 位于不同低点的同一份文件
			- 比较隐蔽的重复数据
				- 加密最好去重之后再做
		- 5.1.2 重复数据是如何消除的
			- 去重系统维护着一个数据库，通常称为哈希表或去重索引，记录着程序以前遇到的所有哈希码。如果这个chunk以前没有遇到过，在写入前，通常先做压缩。
			- 5.1.2.1 去重的执行范围
				- 备份集
					- 只能对同一个备份集中的备份去重。
				- 主机
					- 只能对同一个主机所做的备份去重。
				- 设备
					- 这是最常见的去重范围。能在发给同一台备份设备的所有备份数据之间去重。
				- 站点
					- 单个站点范围去重。
				- 全局
					- 在发给该系统的所有备份数据之间对比。
			- 5.1.2.2 不要只看去重率
				- 重要的是看彻底备份完某套数据之后，这个备份到底占用多大的磁盘空间。
			- 5.1.2.3 chunk的大小很重要
			- 5.1.2.4 文件级别的去重
				- 对象存储实际上就是一种文件级别的去重系统。
		- 5.1.3 目标去重技术
			- 这种去重系统的去重流程通常在某个设备里运行，该设备是所有备份的目标设备。一般通过NFS或SMB与备份软件相连。
			- 5.1.3.1 目标去重为何逐渐流行
			- 5.1.3.2 当场去重与后置去重
				- 当场去重（inline deduplication），系统会先利用CPU对内存中的数据去重，然后写入磁盘。后置去重（post-process deduplication），会先写入磁盘后再去重。
				- 把备份保存为原始格式，而不是去重之后的格式，会让即使恢复之类的执行更顺畅。
				- 如果想要尽快把备份制作出来，或者频繁执行即时恢复，那么后置去重合适。如果想让去重过程尽量与备份过程一起结束，能把写入磁盘的备份尽快复制到其他地方，就应该考虑当场去重。
		- 5.1.4 源端去重技术
			- 备份系统根据位图确定了自从上次制作备份以来发生变化的文件、块、字节或二进制位，接下来判断这个新数据以前是不是从来没有出现过。切块计算chunk的哈希码，并在哈希表中查询。
		- 5.1.5 目标去重与源端去重
		- 5.1.6 混合去重
		- 5.1.7 选择合适的去重方式
	- 5.2 如何在备份系统中使用磁盘
		- 5.2.1 用磁盘给磁带机做缓存
		- 5.2.2 D2D2T
			- Disk-to-Disk-to-Tape，
		- 5.2.3 D2D2D
			- 这种方案既可以跟目标去重技术搭配，也可以跟源端去重技术搭配。
			- 如果是从头开始设计备份系统的，那应该不会采用目标去重技术。
		- 5.2.4 D2C
			- Direct-to-Cloud，这种方案需要配合源端去重技术。
		- 5.2.5 D2D2C
	- 5.3 与恢复有关的概念
		- 5.3.1 镜像恢复
			- 在虚拟机之外的场合，镜像恢复的主要用途是做裸机恢复。如果给启动盘做了镜像备份，那就可以把它恢复到新的盘上，让计算机从其启动。
		- 5.3.2 文件级恢复
			- 5.3.2.1 直接恢复
			- 5.3.2.2 通过SMB/NFS建立共享点以便将数据恢复至其中
			- 5.3.2.3 通过挂载镜像来恢复文件
				- 一种技术是把这个镜像挂载成一个盘。
			- 5.3.2.4 通过SaaS提供的API来恢复文件
		- 5.3.3 即时恢复
			- instant recovery，指的就是用读/写模式挂载启动虚拟机所需的一块或多块磁盘，让虚拟机可以从这些盘启动。
			- 实现即使恢复，一个办法是从用能以原始格式保存镜像备份的备份系统另一种办法是采用能够提前准备虚拟硬盘的备份软件。
			- 某些超融合的数据保护设备能够把备份放到闪存上，这样就不用多占磁盘空间。用去重之后的数据做即时恢复可能有一些问题，但由于性能高，因此能够顺利地处理这些问题。
			- 5.3.3.1 去重方式对即时恢复的效果有很大影响
				- 目标去重由于会把最近的备份以原始格式保存在常规磁盘，即时恢复速度相比当场去重要快很多。
			- 5.3.3.2 怎样合理地使用即时恢复功能
				- 即时恢复不能取代灾难恢复计划。
				- 一个用法是迅速建立一个虚拟机，用以取代受损的虚拟机临时处理一些任务，并在后台启动正式的恢复流程。
				- 另一个用法是建立一个实例做测试或开发。
				- 最大的好处是：在运行这个用来测试的实例时，只需写入发生变化的那一小部分数据。
		- 5.3.4 选择合适的恢复方式
			- 大多数场合还是选用文件级别的恢复。
			- 对虚拟机所执行的恢复基本上都是镜像级的恢复。
- 第6章 保护传统数据源中的数据
	- 6.1 实体服务器
		- 6.1.1 标准备份
		- 6.1.2 裸机备份
			- 裸机备份 ：备份操作系统文件和关键卷上除用户数据以外的所有数据。
		- 6.1.3 备份NAS
			- 6.1.3.1 通过proxy备份
				- 在某台标准服务器上安装一个备份客户端，令其充当proxy，以边挂载filer通过NFS或SMB协议所分享的那个盘。
				- filer指的是分享文件的NAS文件服务器。
				- 缺点在于filer无法区分备份流量与用户流量。
			- 6.1.3.2 NDMP
				- 该协议提供一套API，让备份软件能直接与filer沟通。
				- 最大缺点在于每个filer厂商有可能按它们自己的格式来备份。
			- 6.1.3.3 复制快照
	- 6.2 虚拟服务器
		- 6.2.1 在虚拟机层面备份
			- 把虚拟机当成实体机来备份，最严重的问题在于备份过程中需要执行大量I/O操作。
		- 6.2.2 什么是VSS
			- Windows系统的一种特殊快照机制。
			- 如果要备份的是正在发生变化的东西，可以把备份方式分为两类，一种是crash-consistent，一种是application-consistent。前者指的是把这些正在发生变化的东西在某一时间点所处的状态备份下来。后者优点是能保证应用程序可以从这样的备份里恢复。
			- 做完备份就把日志截断，这是相当常见的操作。
		- 6.2.3 通过虚拟机管理器特有的机制制作备份
			- 6.2.3.1 VADP
				- vSphere Storage API for Data Protection。
				- VMware还能让备份软件与每个Windows虚拟机里的VSS对接，确保备份时application-consistent。
				- Linux系统VMware所能做的是先把内存里的东西写到磁盘中再制作快照。
			- 6.2.3.2 Hyper-V与VSS
				- Hyper-V可以说是一款运行在Windows操作系统里的特殊应用程序。备份软件对接的是Hyper-V里的VSS机制，它要跟虚拟机里的Windows操作系统中的VSS对接，让对方去制作快照。这样制作出来的备份镜像则是applicationconsistent。
			- 6.2.3.3 基于快照的备份
				- 某些存储产品能够与虚拟机管理器所提供的API对接，以便通过虚拟机管理器的快照功能实现备份。
			- 6.2.3.4 HCI
				- Hyper-Converged Infrastructure，这是一种专门为运行虚拟机管理器而设计的特殊硬件，能够与存储设备集成。
			- 6.2.3.5 HCI使用不太常见的虚拟机管理器软件时该如何备份
				- 一个是采用支持这种虚拟机管理器的备份软件来制作备份
				- 另一个是采用HCI产品所内置的数据保护功能来制作备份
				- 如果某个产品既能满足虚拟化的计算、网络与存储需求，又能确保数据在遇到故障时或灾难时得到保护，那确实容易吸引人购买。
		- 6.3 台式机与笔记本电脑
			- 6.3.1 只用来充当缓存的笔记本计算机
			- 6.3.2 普通台式机与笔记本计算机
			- 6.3.3 备份台式机与笔记本计算机的各种方式
				- 6.3.3.1 用移动硬盘备份
					- 违背了321原则，没有把备份放在别处。
				- 6.3.3.2 做文件级的增量备份
					- 不适用于笔记本计算机。
				- 6.3.3.3 通过文件同步与分享工具备份
					- 如何应对勒索攻击。
				- 6.3.3.4 采用结合了源端去重技术的备份系统或服务来做备份
					- 只有这个办法，才能够真正给台式机与笔记本计算机做备份。
		- 6.4 移动设备
			- 6.4.1 把数据同步到云平台
			- 6.4.2 把数据同步到实体机再备份
			- 6.4.3 在移动设备上备份
				- iOS或者Android设备上的备份软件很难访问到设备中的其他应用程序的数据。
			- 6.4.4 移动设备管理
				- Mobile Device Management，MDM。把一款特制的程序安装在这种设备上，让这个应用程序持有与本组织相关的所有数据。
- 第7章 保护数据库中的数据
	- 7.1 数据库的交付模型
		- 7.1.1 以传统软件的方式来交付的数据库
			- 你要备份的数据文件，其内容在持续地变化
			- 你可以把数据库恢复到制作备份的那个时间点
			- 可以从某个时间点向前（或向后）滚动
		- 7.1.2 以PaaS方式交付的数据库
			- 只能看到数据库应用程序，对程序背后的基础设施仅有相当少的访问权，甚至没有。
		- 7.1.3 serverless数据库
			- 不要求用户做出管理。与PaaS类似，这种数据库的备份方式也是由提供该数据库的厂商决定的。
	- 7.2 数据库模型
		- 常见5种模型。
		- 关系型数据库管理系统
			- RDBMS，由一系列数据表table构成，每张数据表都定义由纲要schema，schema决定了表格的布局layout。数据表由记录record构成，一条记录相当于一行row，每条记录都包含一个或多个属性attribute，也成为值value。
		- 键值存储
			- NoSQL数据库的一种。Redis与DynamoDB比较常见。
		- 时间序列数据库
			- 专门用于处理时间数据的一种NoSQL数据库。其中的时间数据都有时间戳，能够体现出先后顺序。Prometheus。
		- 文档存储
			- JSON格式存储，MongoDB。
		- 图数据库
			- 通过图graph结构来查询。Neo4j。
		- 搜索引擎
			- 专门为了搜索而优化的NoSQL数据库。Elasticsearch。
		- 宽列数据库
			- 无schema的NoSQL数据库管理系统。
	- 7.3 一致性模型
		- consistency model，用户刚给数据库里插入一条新的记录之后，其他用户可以立即看到，那么是立即一致性模型，如果不能则是最终一致性模型，两种都有就是混合一致性模型。
		- 立即一致性
			- immediate consistency也叫强一致性strong consistency，大多数传统数据库用的都是这种模型。
		- 最终一致性
			- eventual consistency。
		- 混合一致性
			- hybird consistency通常用在一些NoSQL数据库里，这种数据库支持以最终一致性的方式写入数据，同时又支持在读取数据时通过API来指定你是按照立即还是最终读取。
		- 7.3.1 位于本组织数据中心里的传统数据库
			- 采用立即一致性模型，只关心节点故障而不关心存储故障，通常设计就是采用两个高度可用的主机，共享同一个存储阵列。
			- 采用立即一致性模型，但想要一个全冗余系统，fully redundant system，可以采用shared-nothing架构。
			- 采用最终一致性或者混合一致性，如果某个节点上的数据发生变化，该节点立刻记录更新，并根据要求把新的数据复制到一定数量的replica上，一般会复制到三个replica上。
		- 7.3.2 PaaS数据库与serverless数据库
	- 7.4 传统数据库的术语
		- 7.4.1 实例
			- 实例instance是运行在一个或多个计算机上的一组进程，凡是属于该实例的数据库都可以通过这组进程连接到共享内存并通信。
		- 7.4.2 数据库
			- 数据库database是由数据库对象所构成的集合。
		- 7.4.3 表
			- 表table是数据库里的一组相互关联的信息。
		- 7.4.4 索引
			- 索引index是一种由特殊用途的对象，专门用来查找表格中的数据。
		- 7.4.5 行
			- 行row是由相互关联的属性所构成的集合。
		- 7.4.6 属性
			- 表中最基本的元素就是属性attribute。
		- 7.4.7 数据文件
			- 数据文件data file是存放数据的地方。
		- 7.4.8 表空间
			- 表空间tablespace是由一个或多个数据文件所构成的集合，数据表会添加到这个空间里。
		- 7.4.9 分区
			- 把一张数据表分布到多个资源上。
		- 7.4.10 主文件
			- 记录某个已经安装好的数据库环境里的全部元素。
		- 7.4.11 事务
			- 任何一种发生在数据库里，且要修改其中一项或多项属性的活动，都可以称为事务transaction。
		- 7.4.12 事务日志
			- 如果数据库在执行事务的过程中崩溃，数据库如何了解这一情况，以判断是否要回滚，这就要靠事务日志了。
	- 7.5 给采用传统方式交付的数据库制作备份
		- 7.5.1 冷备份
			- cold backup
		- 7.5.2 在专门剥离出来的replica上做备份
		- 7.5.3 热备份模式
			- hot backup。
		- 7.5.4 snap and sweep
			- 先做快照再清理，采用数据库提供的快照命令进行备份。
		- 7.5.5 dump and sweep
			- 传统方式最流行的备份方式，先转储再清理。
			- RMAN或mysqldump
			- 使用脚本做备份时需要注意的问题
		- 7.5.6 让数据流入备份软件
		- 7.5.7 事务日志的备份方式
		- 7.5.8 主文件的备份方式
	- 7.6 备份PaaS与serverless数据库
		- 7.6.1 dump and sweep
			- 在备份PaaS数据库时，很少出现只能采用这种方式来备份的情况。
		- 7.6.2 通过数据库所集成的备份即服务机制来备份
			- 很多厂商都支持这样一种流程，让数据库服务创建image copy，也称为snapshot，通常保存在另一个存储系统里，以遵循3-2-1原则。
			- 7.6.2.1 一定要对备份做测试
			- 7.6.2.2 3-2-1原则
			- 7.6.2.3 常见的几种数据库产品的备份方式
				- Oracle，RMAN。
				- SQL Server，通过backup database命令或VSS方案。
				- DB2，backup database命令，还有一个snapshot标志。
				- MySQL，enterprise backup 或mysqldump。
				- PostgreSQL，pg dump。
				- MongoDB，云备份。
	- 7.7 恢复传统数据库
		- 确定问题出在哪里
		- 恢复数据文件
		- 做介质恢复
			- 如果数据库能够重放事务日志，那就可以在恢复数据库后重放。
		- 启动数据库
	- 7.8 恢复新型数据库
		- 有些数据库无需做介质恢复即可实现时间点恢复
			- 比如频繁基于快照的备份，并以此实现时间点恢复。
		- 基于数据表的恢复
		- 节点层面的恢复
		- 云端快照
		- 可能要在执行完恢复之后确保此部分数据与其他数据一致
- 第8章 保护新型数据源中的数据
	- 其实根本没有所谓的云，它只不过是别人的计算机而已。
	- 8.1 公有云
		- 8.1.1 IaaS
			- IaaS，Infrastructure-as-a-Service
			- 第一种备份方案是像备份传统虚拟机那样来备份云端虚拟机。
			- 第二种是采用云厂商原生工具来备份。
			- 8.1.1.1 云平台中的块存储
				- AWS EBS快照，对卷创建逐字节的镜像副本，存储在另一个系统比如S3上。
			- 8.1.1.2 云平台中的对象存储
				- 与文件不同，对象是根据其内容来确定身份的。每个对象都会交由SHA-1这样的加密哈希算法来处理。
				- 对象存储中的对象绝不会改变。
				- Write-Once-Read-Many，单写多读。
		- 8.1.2 PaaS
			- 数据库平台、应用平台或是虚拟化平台。
		- 8.1.3 serverless服务
			- 这样的应用程序不需要配置或管理任何东西。以DynamoDB为例，可以对其做出配置，让它频繁创建备份，并存储到AWS下。
		- 8.1.4 SaaS
			- SaaS应用程序是指为了某种目标而专门构建的全方位应用程序，比如Microsoft 365、Salesforce、Slack等。
			- 不要求用户自己去搭建基础设施
			- 经常自动更新
			- 按用量付费
			- 不包含备份机制
			- 8.1.4.1 Salesforce
			- 8.1.4.2 Microsoft 365
				- 不提供备份恢复功能，只有便捷恢复。
			- 8.1.4.3 Google Workspace
				- 类似Microsoft 365
		- 8.1.5 云数据也需要保护
			- 公有云没有改变数据保护领域的基本情况。
			- Code Spaces事故后发现，没有按照管理启用多因素认证，让入侵者获取到访问权限，并且产品数据与备份数据放在同一个账号里。
	- 8.2 怎样备份各种混合云平台里的数据
		- hybrid cloud模型，把适合放在云端处理的任务移动到云端，同时把那些适合在本地处理的任务留在数据中心。
		- 8.2.1 NFS/SMB网关
			- 最经典的混合云产品，就是那种通常称为云网关cloud gateway的东西。主要思路是让应用程序与用户去使用数据中心里的某台设备，但实际上，此设备会将数据保存到云端。
		- 8.2.2 云盒
			- cloud in a box
	- 8.3 Docker与Kubernetes
		- 8.3.1 容器如何改变传统的备份方式
		- 8.3.2 Dockerfile
			- 首先考虑github来做版本管理系统，控制所有的Dockerfile。每个k8s deployment有关的YAML也应纳入代码库。
		- 8.3.3 Docker镜像
			- Docker Hub backup
		- 8.3.4 Kubernetes etcd
			- 把这个数据库备份下来，能帮我们对整个集群做元数据恢复。
		- 8.3.5 持久卷
			- CSI PVC，内置数据保护功能，创建标准快照。
		- 8.3.6 数据库
			- mysqldump
			- 在K8s里，给数据库注入一条命令进入quiesce状态，这样就能制作快照，使用snap-and-sweep方式备份。
		- 8.3.7 K8s改变了数据保护领域的局面
	- 8.4 物联网
		- 物联网是边缘计算的一个子集，它所连接的设备在本组织的数据环境里处于相当边缘的地位。
	- 8.5 如何做备份决策
		- 8.5.1 数据的重要程度
		- 8.5.2 数据源的特点
- 第9章 如何设计备份与恢复方案
	- 用传统手段来恢复数据的备份方案归入第一大类。
	- 第二大类的方案支持一个叫做即时恢复的概念。
	- 9.2 支持传统恢复流程的备份方案
		- 9.2.1 multiplexing
			- 多路复用本身不是一种备份手法。会把多个增量备份交织起来，创建出一条内容更多、速度更快的数据流。
		- 9.2.2 传统的完全备份与增量备份
			- 最近几年，许多人改成每月做一次完全备份，每周做一次积累式的增量备份，每天做一次常规的增量备份。
		- 9.2.3 文件级别的incremental forever
			- 如果某份文件里有某个内容发生变化，那么该文件的修改时间或存档位有所改变，于是我们就把整份文件备份下来。
			- 只能在刚启用时做一次完全备份，然后必须一直做增量备份。
		- 9.2.4 块级别的incremental forever
			- 要想实施该方案，某些应用程序必须维护一种位图，指出那部分数据发生了变化，通常又称为CBT。
		- 9.2.5 源端去重
			- source deduplication。这种办法备份的数据，要比块级别的incremental forever方案更少。
			- 适合备份远程设备。
	- 9.3 支持即时恢复的备份方案
		- 在数据遭到损坏之后，无需经历某种恢复流程就可以将其立刻恢复出来。
		- 9.3.1 复制
			- replication。首先确定一个想要保护的卷或文件系统，让它作为源卷source volume，再确定另一台主机里的某个卷或文件系统成为复制的目标，target volume。
			- 9.3.1.1 同步复制
			- 9.3.1.2 异步复制
				- 复制过程可能久，会根据情况会执行写入合并write coalescing。
			- 9.3.1.3 混合复制
			- 9.3.1.4 数据库复制
				- 数据库复制通常采用异步方式执行。
			- 9.3.1.5 复制技术的局限
				- 复制系统没有后退按钮。
		- 9.3.2 CDP
			- Continuous Data Protection。式一个带有变更日志的异步复制系统。它能把数据库恢复到变更日志所涵盖的任何一个时间点，而且几乎立刻就能恢复好。
			- 第一类系统总是会针对有待保护的应用程序、数据库或卷来维护一份随时能够上线的镜像。
			- 第二类把目前以及将来恢复时有可能用到的各种数据块全部存储起来，并拿这些数据块构造成一个虚拟卷。缺点是性能差。
		- 9.3.3 快照
			- 专指虚拟快照virtual snapshot。创建快照的那一刻，创建的其实是源卷的一份虚拟副本virtual copy。
			- 9.3.3.1 写时复制
				- copy-on-write，快照软件先把旧版的数据块复制并发送到一个特殊区域，然后再用你想要写入的内容把这个数据块更新到新版。缺点是快照越多性能越差。
			- 9.3.3.2 写时重定向
				- redirect-on-write，如果更新某份文件，此时文件系统只需要把新版的数据块写到其他地方，并且让相应的指针指向那些地方。
			- 9.3.3.3 暂时拦阻所有的写入操作
				- 根据某个卷制作VMware快照，那么文件系统会把针对该卷的所有写入暂时拦截，直到快照释放再放行。
			- 9.3.3.4 快照的优点与缺点
				- 快照让你能够访问到某个文件与卷的各个版本，而且只需占用很少的空间，如果源卷频繁发生变化，那么快照可能也会随之迅速膨胀。
		- 9.3.4 准CDP
			- 将快照与复制结合时一种相当棒的准CDPnear-CDP系统。把源数据复制一份放在主站，据此制作副本放置在远离主站的地方，满足3-2-1原则。
			- 如果把源数据发生得每个变化都复制下来，即使是异步复制也是CDP。如果频繁地制作微型快照，并把这些快照之间地差量复制下来，那么就是准CDP。
		- 9.3.5 CDM
			- Copy Data Management，CDM地理念是让副本具备包括恢复数据在内地多项功能，并提供一个集中地系统，让副本能够在这里体现出这些功能，同时节省存储与管理方面地成本。
		- 9.3.6 支持即时恢复的其他软件方案
	- 9.4 让备份发挥更多功效
		- 电子取证功能。
		- 检查数据是否符合各项法律法规。
		- 扫描备份数据组织勒索攻击，通过机器学习算法关注增量备份里是否出现文件量激增的情况。
		- 提供一种能以读/写模式挂载的快照。
		- 通过机器学习算法做历史数据分析。
	- 9.5 如何选取备份方案
		- 9.5.1 已有备份方案是否能满足需求
		- 9.5.2 权衡各种备份方案的优劣
		- 9.5.3 直接购买整套解决方案
			- 一类产品要求你必须明确触发恢复流程，另一类则支持即时恢复。
- 第10章 如何设计档案系统
	- 10.1 深入了解档案
	- 10.2 获取与恢复之间的区别
	- 10.3 档案系统的类型
		- 10.3.1 传统的批次档案系统
		- 10.3.2 实时档案系统
		- 10.3.3 HSM档案系统
	- 10.4 如何选择档案系统
		- 10.4.1 是否需要档案系统
		- 10.4.2 收集需求
			- 10.4.2.1 数据格式问题
			- 10.4.2.2 存储介质
			- 10.4.2.3 需要考虑的其他问题
			- 10.4.2.3 档案系统与备份系统是应该分开，还是应该整合？
-